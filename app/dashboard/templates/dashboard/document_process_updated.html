{% extends "base.html" %}

{% block title %}Process Document{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="row">
        <div class="col-12">
            <div class="card mb-4">
                <div class="card-header pb-0 d-flex justify-content-between align-items-center">
                    <h6>Process Document</h6>
                    <a href="/dashboard/documents/{{ document.id }}" class="btn btn-sm btn-outline-secondary">
                        <i class="fas fa-arrow-left me-1"></i> Back to Document
                    </a>
                </div>
                <div class="card-body position-relative">
                    <!-- Processing animation overlay -->
                    <div id="processing-overlay" style="display: none;" class="position-absolute top-0 start-0 w-100 h-100 bg-white bg-opacity-75 d-flex flex-column justify-content-center align-items-center">
                        <div class="spinner-border text-primary mb-3" role="status" style="width: 3rem; height: 3rem;">
                            <span class="visually-hidden">Processing...</span>
                        </div>
                        <h5 class="mb-2">Processing PDF...</h5>
                        <p class="text-center text-muted mb-4">This may take up to a minute depending on the document size and complexity</p>
                        <div id="process-results" class="w-75 d-none">
                            <div class="alert alert-success">
                                <h6 class="alert-heading mb-2">Processing complete!</h6>
                                <p class="mb-2">Your document has been processed successfully.</p>
                                <div id="processing-results-actions" class="mt-3">
                                    <a id="view-results-btn" href="#" class="btn btn-sm btn-success me-2">View Results</a>
                                    <a id="process-another-btn" href="#" class="btn btn-sm btn-outline-secondary">Process Another</a>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <form id="process-form" method="POST">
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <h6 class="text-uppercase text-muted mb-2">Document</h6>
                                    <p class="mb-1">{{ document.filename or "Unnamed PDF" }}</p>
                                    <p class="text-sm text-secondary mb-0 text-truncate">{{ document.url }}</p>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <h6 class="text-uppercase text-muted mb-2">File Info</h6>
                                    <p class="mb-1">
                                        {% if document.file_size %}
                                        Size: {{ (document.file_size / 1024) | round(1) }} KB
                                        {% else %}
                                        Size: Unknown
                                        {% endif %}
                                    </p>
                                    <p class="text-sm text-secondary mb-0">MIME Type: {{ document.mime_type or "Unknown" }}</p>
                                </div>
                            </div>
                        </div>

                        <div class="row mb-4">
                            <div class="col-md-12">
                                <h6>Processing Options</h6>
                                <div class="card bg-light">
                                    <div class="card-body">
                                        <div class="form-check form-switch mb-3">
                                            <input class="form-check-input" type="checkbox" name="extract_metadata" id="extract_metadata" checked>
                                            <label class="form-check-label" for="extract_metadata">Extract Metadata</label>
                                            <p class="text-xs text-secondary mb-0">Extract title, authors, abstract, publication date, etc.</p>
                                        </div>
                                        
                                        <div class="form-check form-switch mb-3">
                                            <input class="form-check-input" type="checkbox" name="extract_references" id="extract_references" checked>
                                            <label class="form-check-label" for="extract_references">Extract References</label>
                                            <p class="text-xs text-secondary mb-0">Extract citation references from the document.</p>
                                        </div>
                                        
                                        <div class="form-check form-switch mb-3">
                                            <input class="form-check-input" type="checkbox" name="extract_full_text" id="extract_full_text">
                                            <label class="form-check-label" for="extract_full_text">Extract Full Text</label>
                                            <p class="text-xs text-secondary mb-0">Extract the complete text content of the document.</p>
                                        </div>
                                        
                                        <div class="form-check form-switch mb-3">
                                            <input class="form-check-input" type="checkbox" name="complete_references" id="complete_references">
                                            <label class="form-check-label" for="complete_references">Complete References</label>
                                            <p class="text-xs text-secondary mb-0">Attempt to complete partial reference information.</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row mb-4">
                            <div class="col-md-12">
                                <div class="mb-3">
                                    <label for="webhook_url" class="form-label">Webhook URL (Optional)</label>
                                    <input type="url" class="form-control" id="webhook_url" name="webhook_url" placeholder="https://your-webhook-url.com">
                                    <div class="form-text text-xs text-secondary">
                                        If provided, we'll send a POST request with processing results when completed.
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-12 text-center">
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-sync me-1"></i> Process Document
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="/dashboard/static/js/document_process.js"></script>
{% endblock %}
